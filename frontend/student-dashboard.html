<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="./student-dashboard.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body>
    <!-- Menu Button -->
    <button class="menu-toggle" id="menu-toggle">&#9776;</button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">cipherford</div>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <li><a href="#" class="active" data-section="home">Dashboard</a></li>
          <li><a href="#" data-section="leaderboard">Leaderboard</a></li>
          <li><a href="#" data-section="badges">My Badges</a></li>
          <li><a href="#" data-section="certificates">My Certificate</a></li>
          <li><a href="#" data-section="resources">Resources</a></li>
          <li><a href="#" data-section="logout">Logout</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="student-dashboard" id="dashboard">
      <header class="dashboard-header">
        <div class="profile-info">
          <span id="student-name">Student Name</span>
        </div>
      </header>

      <!-- Sections -->
      <section id="home-section" class="dashboard-section active">
        <h2>Welcome, <span id="student-name-card">Student Name</span></h2>
        <div
          id="home-loader"
          class="loader"
          style="display: none; margin: 15px auto"
        ></div>
        <!-- Progress Cards -->
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <h3>Current Level</h3>
            <p id="student-level">1</p>
          </div>
          <div class="dashboard-card">
            <h3>Total Points</h3>
            <p id="student-points">0</p>
          </div>
          <div class="dashboard-card">
            <h3>Attendance (Week)</h3>
            <p id="attendance-week">0</p>
          </div>
          <div class="dashboard-card">
            <h3>Projects Completed</h3>
            <p id="projects-done">0</p>
          </div>
        </div>

        <!-- Upcoming Sessions -->
        <section class="upcoming-sessions">
          <h3>Upcoming Sessions</h3>
          <ul id="upcoming-sessions-list">
            <li>No upcoming sessions</li>
          </ul>
        </section>
        <!-- testing -->
        <!-- Progress Charts -->
        <section class="charts">
          <h3>Progress Reports</h3>
          <div class="chart" id="level-progress-chart">
            [Level Progress Chart]
          </div>
          <div class="chart" id="attendance-chart">[Attendance Chart]</div>
          <div class="chart" id="projects-chart">[Projects Chart]</div>
        </section>
      </section>
      <section id="leaderboard-section" class="dashboard-section">
        <h2>Leaderboard</h2>
        <div class="table-wrapper">
          <div
            id="leaderboard-loader"
            class="loader"
            style="display: none; margin: 15px auto"
          ></div>
          <table id="leaderboard-table">
            <thead>
              <tr>
                <th>#</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Points</th>
                <th>Level</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="6">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <section id="badges-section" class="dashboard-section">
        <h2>My Badges</h2>
        <div class="table-wrapper">
          <div
            id="badges-loader"
            class="loader"
            style="display: none; margin: 15px auto"
          ></div>
          <table id="badges-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Description</th>
                <th>Badge</th>
                <th>Awarded At</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <section id="certificates-section" class="dashboard-section">
        <h2>My Certificates</h2>
        <div class="table-wrapper">
          <div
            id="certificates-loader"
            class="loader"
            style="display: none; margin: 15px auto"
          ></div>
          <table id="certificates-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Description</th>
                <th>Preview</th>
                <th>Issued At</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <section id="resources-section" class="dashboard-section">
        <h2>My Resources</h2>
        <div class="table-wrapper">
          <div
            id="resources-loader"
            class="loader"
            style="display: none; margin: 15px auto"
          ></div>
          <table id="resources-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Preview</th>
                <th>Created At</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- Logout Modal -->
    <div id="logout-modal" class="logout-container" style="display: none">
      <div class="logout-card">
        <h4>Logout Confirmation</h4>
        <p>Are you sure you want to logout?</p>
        <div class="logout-buttons">
          <button id="logout-cancel-btn" class="btn cancel-btn">Cancel</button>
          <button id="logout-confirm-btn" class="btn confirm-btn">
            Logout
          </button>
        </div>
      </div>
    </div>
    <!-- Badge Modal -->
    <!-- <div id="badge-modal" class="badge-modal" style="display: none">
      <div class="modal-content">
        <span id="badge-modal-close" class="close-btn">&times;</span>
        <img id="badge-modal-image" src="" alt="Badge" />
        <a id="badge-modal-download" href="" download class="download-btn"
          >Download</a
        >
      </div>
    </div> -->

    <!-- Certificate Modal -->
    <div id="badge-modal" class="badge-modal" style="display: none">
      <div class="badges-content">
        <span id="badge-modal-close" class="badges-modal-close">&times;</span>
        <iframe
          id="badge-modal-frame"
          src=""
          style="width: 100%; height: 400px; border: none"
        ></iframe>
        <a
          id="badge-modal-download"
          href="#"
          download
          class="badge-download-btn"
          >Download</a
        >
      </div>
    </div>
    <div id="certificate-modal" class="badge-modal" style="display: none">
      <div class="certificates-content">
        <span id="certificate-modal-close" class="certificates-modal-close"
          >&times;</span
        >
        <iframe
          id="certificate-modal-frame"
          src=""
          style="width: 100%; height: 400px; border: none"
        ></iframe>
        <a
          id="certificate-modal-download"
          href="#"
          download
          class="certificate-download-btn"
          >Download</a
        >
      </div>
    </div>
    <!-- resources modal -->

    <div id="resource-modal" class="resource-modal" style="display: none">
      <div class="resource-content">
        <span id="resource-modal-close" class="resource-modal-close"
          >&times;</span
        >
        <iframe
          id="resource-modal-frame"
          src=""
          style="width: 100%; height: 400px; border: none"
        >
        </iframe>
        <a
          id="resource-modal-download"
          href="#"
          download
          class="resource-download-btn"
        >
          Download
        </a>
      </div>
    </div>

    <!-- JS -->
    <script type="module" src="./student-dashboard-router.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const menuBtn = document.getElementById("menu-toggle");
        const sidebar = document.getElementById("sidebar");
        const logoutModal = document.getElementById("logout-modal");
        const cancelBtn = document.getElementById("logout-cancel-btn");
        const confirmBtn = document.getElementById("logout-confirm-btn");
        const dashboardLinks = document.querySelectorAll(".sidebar-nav a");

        // Open sidebar
        menuBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          sidebar.classList.add("active");
          menuBtn.style.display = "none";
        });

        // Close sidebar on link click
        dashboardLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            const section = link.dataset.section;
            if (section === "logout") {
              e.preventDefault();
              logoutModal.style.display = "flex";
            }
            sidebar.classList.remove("active");
            menuBtn.style.display = "block";
          });
        });

        // Cancel logout
        cancelBtn.addEventListener("click", () => {
          logoutModal.style.display = "none";
          document.querySelector('[data-section="home"]').click();
        });

        // Confirm logout
        confirmBtn.addEventListener("click", () => {
          // Only remove student-specific key
          localStorage.removeItem("loggedInStudent");
          window.location.href = "login.html";
        });

        // Click outside to close sidebar
        window.addEventListener("click", (e) => {
          if (
            sidebar.classList.contains("active") &&
            !sidebar.contains(e.target) &&
            !menuBtn.contains(e.target)
          ) {
            sidebar.classList.remove("active");
            menuBtn.style.display = "block";
          }

          if (e.target === logoutModal) {
            logoutModal.style.display = "none";
          }
        });
      });
    </script>
  </body>
</html>
